{% extends "base.html" %}

{% block title %}Dashboard - LLM Observability{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>Dashboard</h1>

    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-value">{{ "{:,}".format(metrics.total_responses) }}</div>
            <div class="metric-label">Total Responses</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ "{:,}".format(metrics.total_conversations) }}</div>
            <div class="metric-label">Conversations</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ "{:,}".format(metrics.total_tokens) }}</div>
            <div class="metric-label">Total Tokens</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ "{:,}".format(metrics.avg_duration_ms) }}ms</div>
            <div class="metric-label">Avg Duration</div>
        </div>
        <div class="metric-card">
            <div class="metric-value">{{ metrics.unique_models }}</div>
            <div class="metric-label">Models Used</div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-section">
            <h2>Model Usage</h2>
            {% if model_usage %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th class="text-right">Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in model_usage %}
                    <tr>
                        <td><code>{{ item.model }}</code></td>
                        <td class="text-right">{{ "{:,}".format(item.count) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="empty-state">No model data available</p>
            {% endif %}
        </div>

        <div class="dashboard-section">
            <h2>Recent Responses</h2>
            {% if recent_responses %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Model</th>
                        <th>Prompt</th>
                    </tr>
                </thead>
                <tbody>
                    {% for response in recent_responses %}
                    <tr>
                        <td class="nowrap">
                            <a href="/responses/{{ response.id }}">
                                {{ response.datetime_utc[:16] if response.datetime_utc else 'N/A' }}
                            </a>
                        </td>
                        <td><code>{{ response.model }}</code></td>
                        <td class="truncate">{{ (response.prompt or '')[:100] }}{% if response.prompt and response.prompt|length > 100 %}...{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <p class="section-footer"><a href="/responses">View all responses &rarr;</a></p>
            {% else %}
            <p class="empty-state">No responses yet</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
