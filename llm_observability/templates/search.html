{% extends "base.html" %}

{% block title %}Search - LLM Observability{% endblock %}

{% block content %}
<div class="page">
    <div class="page-header">
        <h1>Search</h1>
    </div>

    <form action="/search" method="get" class="search-page-form">
        <input type="text" name="q" value="{{ query }}" placeholder="Search prompts and responses..." class="search-page-input" autofocus>
        <button type="submit" class="search-button">Search</button>
    </form>

    {% if query %}
    <div class="search-results">
        <p class="search-info">
            {% if total > 0 %}
            Found {{ "{:,}".format(total) }} result{% if total != 1 %}s{% endif %} for "<strong>{{ query }}</strong>"
            {% else %}
            No results found for "<strong>{{ query }}</strong>"
            {% endif %}
        </p>

        {% if results %}
        <div class="result-list">
            {% for result in results %}
            <div class="result-item">
                <div class="result-header">
                    <a href="/responses/{{ result.id }}" class="result-link">
                        {{ result.datetime_utc[:16] if result.datetime_utc else 'N/A' }}
                    </a>
                    <code class="result-model">{{ result.model }}</code>
                    {% if result.conversation_id %}
                    <a href="/conversations/{{ result.conversation_id }}" class="result-conv">In conversation</a>
                    {% endif %}
                </div>

                {% if result.prompt_snippet %}
                <div class="result-snippet">
                    <strong>Prompt:</strong>
                    <span class="snippet-text">{{ result.prompt_snippet }}</span>
                </div>
                {% endif %}

                {% if result.response_snippet %}
                <div class="result-snippet">
                    <strong>Response:</strong>
                    <span class="snippet-text">{{ result.response_snippet }}</span>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        {% if total_pages > 1 %}
        <nav class="pagination">
            {% if page > 1 %}
            <a href="?q={{ query }}&page={{ page - 1 }}" class="page-link">&laquo; Previous</a>
            {% endif %}

            <span class="page-info">Page {{ page }} of {{ total_pages }}</span>

            {% if page < total_pages %}
            <a href="?q={{ query }}&page={{ page + 1 }}" class="page-link">Next &raquo;</a>
            {% endif %}
        </nav>
        {% endif %}
        {% endif %}
    </div>
    {% else %}
    <p class="search-hint">Enter a search query to find prompts and responses</p>
    {% endif %}
</div>
{% endblock %}
